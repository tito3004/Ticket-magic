import{a as W}from"./chunk-5ELSBVWL.js";import{C as Q,b as L,c as G,d as H,e as R,f as q,g as V,i as z,j as J,o as B,s as U,t as $,w as K}from"./chunk-LC3UPVSU.js";import"./chunk-ELOAIK2V.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VR5KVVOC.js";import"./chunk-3Q5GMNK6.js";import"./chunk-RS5YQJWL.js";import"./chunk-JROSCJGS.js";import"./chunk-OK2I7K27.js";import"./chunk-4CFH7RX6.js";import"./chunk-7FY2OE2O.js";import"./chunk-2QSXEBB7.js";import"./chunk-TTVFM5DY.js";import"./chunk-EZWARTTP.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-HLX4SABQ.js";import"./chunk-CKP3SGE2.js";import"./chunk-OVQHLAQL.js";import{$ as F,B as S,Da as O,F as b,I as l,J as t,K as n,L as _,S as f,T as P,_ as o,aa as C,gb as g,hb as x,ib as k,kb as w,lb as M,mb as D,oa as j,pa as y,qb as N,rb as T,sb as A,ua as I,x as r,z as v}from"./chunk-WQ2GXVAN.js";import"./chunk-IGVXFY24.js";import"./chunk-5TIAO6TV.js";import"./chunk-BANGDX2W.js";import"./chunk-FZQDFHAZ.js";import"./chunk-CLDSZD2A.js";import"./chunk-M2X7KQLB.js";import"./chunk-XTVTS2NW.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-JHI3MBHO.js";function X(s,d){if(s&1&&(t(0,"ion-select-option",21),o(1),n()),s&2){let u=d.$implicit;l("value",u.nombre_artista),r(),C(" ",u.nombre_artista," ")}}function Y(s,d){if(s&1&&(t(0,"ion-select-option",21),o(1),n()),s&2){let u=d.$implicit;l("value",u.nombre_lugar),r(),C(" ",u.nombre_lugar," ")}}function Z(s,d){s&1&&(t(0,"div")(1,"small"),o(2,"Sin imagen seleccionada"),n()())}function ee(s,d){if(s&1&&(t(0,"div")(1,"small"),o(2),n()()),s&2){let u=P();r(2),C("Imagen: ",u.imagenFile==null?null:u.imagenFile.name)}}var ce=(()=>{let d=class d{constructor(i,a,e){this.fb=i,this.admin=a,this.router=e,this.json_fechas=[],this.json_horas=[],this.json_lugar=[],this.lugaresDisponibles=[],this.artistasDisponibles=[],this.imagenFile=null,this.redirectAfterSave="/tabs-admin/evento",this.saving=!1,this.eventoForm=this.fb.group({nombre_evento:["",[g.required,g.minLength(3),g.maxLength(120)]],tipo_evento:["",[g.required]],artista_sel:[null,[g.required]],descripcion:["",[g.maxLength(800)]],lugares_sel:[[],[g.required]]}),this.fechaForm=this.fb.group({inicio:["",[g.required]],fin:["",[g.required]]}),this.horaForm=this.fb.group({hora:["",[g.required]]})}ngOnInit(){this.admin.consultar_lugares().subscribe({next:i=>{this.lugaresDisponibles=i?.value??[]},error:i=>console.error("Error lugares:",i)}),this.admin.consultar_artista().subscribe({next:i=>{this.artistasDisponibles=i?.value??[]},error:i=>console.error("Error artistas:",i)})}agregarFechasDeRango(){if(this.fechaForm.invalid)return;let{inicio:i,fin:a}=this.fechaForm.value,e=new Date(i),h=new Date(a);if(e>h){alert("Rango de fechas inv\xE1lido");return}let p=[],m=new Date(e);for(;m<=h;){let c=m.toISOString().slice(0,10);this.json_fechas.some(E=>E.fecha===c)||p.push({fecha:c}),m.setDate(m.getDate()+1)}this.json_fechas.push(...p),this.json_fechas.sort((c,E)=>c.fecha.localeCompare(E.fecha)),this.fechaForm.reset()}limpiarFechas(){this.json_fechas=[]}agregarHora(){if(this.horaForm.invalid)return;let{hora:i}=this.horaForm.value;this.json_horas.some(a=>a.hora===i)||this.json_horas.push({hora:i}),this.json_horas.sort((a,e)=>a.hora.localeCompare(e.hora)),this.horaForm.reset()}limpiarHoras(){this.json_horas=[]}onLugaresChange(i){let a=new Set((i??[]).map(e=>e.trim().toLowerCase()));this.json_lugar=this.lugaresDisponibles.filter(e=>a.has(e.nombre_lugar.trim().toLowerCase()))}onFileChange(i){let a=i.target;this.imagenFile=a.files?.[0]??null}guardarEvento(){let i=this.eventoForm.get("lugares_sel")?.value??[];if(this.onLugaresChange(i),this.eventoForm.invalid||!this.json_fechas.length||!this.json_horas.length||!this.json_lugar.length||!this.imagenFile){this.eventoForm.markAllAsTouched(),alert("Completa todos los campos y agrega al menos una fecha, hora y lugar.");return}if(this.saving)return;this.saving=!0;let{nombre_evento:a,tipo_evento:e,artista_sel:h,descripcion:p}=this.eventoForm.value,m=new FormData;m.append("nombre_evento",a),m.append("tipo_evento",e),m.append("nombre_artista",h),m.append("descripcion",p||""),m.append("json_fechas",JSON.stringify(this.json_fechas.map(c=>c.fecha))),m.append("json_horas",JSON.stringify(this.json_horas.map(c=>c.hora))),m.append("json_lugar",JSON.stringify(this.json_lugar)),m.append("imagen",this.imagenFile,this.imagenFile.name),this.admin.agregar_evento(m).subscribe({next:c=>{c.status?(this.resetAll(),alert("Evento registrado"),this.router.navigate(["/tabs-admin/calendario"])):alert(c.message||"Error al registrar evento")},error:c=>{console.error("Error al registrar evento:",c),alert("Ocurri\xF3 un problema. Int\xE9ntalo nuevamente.")},complete:()=>this.saving=!1})}get totalFechas(){return this.json_fechas.length}get totalHoras(){return this.json_horas.length}get totalLugares(){return this.json_lugar.length}resetAll(){this.eventoForm.reset({nombre_evento:"",tipo_evento:"",artista_sel:null,descripcion:"",lugares_sel:[]}),this.eventoForm.markAsPristine(),this.eventoForm.markAsUntouched(),this.fechaForm.reset(),this.horaForm.reset(),this.json_fechas=[],this.json_horas=[],this.json_lugar=[],this.imagenFile=null,window?.scrollTo?.({top:0,behavior:"smooth"})}};d.\u0275fac=function(a){return new(a||d)(v(N),v(W),v(O))},d.\u0275cmp=S({type:d,selectors:[["app-evento"]],decls:57,vars:16,consts:[[1,"fondo-gradiente"],[1,"formulario-centro"],[1,"form-card"],[1,"titulo"],[3,"formGroup"],["label","Nombre del evento","labelPlacement","floating","fill","outline","formControlName","nombre_evento",1,"field"],["label","Tipo de evento","labelPlacement","floating","fill","outline","formControlName","tipo_evento",1,"field"],["label","Artista","labelPlacement","floating","fill","outline","formControlName","artista_sel",1,"field"],[3,"value",4,"ngFor","ngForOf"],["label","Lugar(es)","labelPlacement","floating","fill","outline","formControlName","lugares_sel",1,"field",3,"ionChange","multiple"],["label","Descripci\xF3n","labelPlacement","floating","fill","outline","autoGrow","true","formControlName","descripcion",1,"field"],[1,"grid-localidad",3,"formGroup"],["type","date","label","Inicio","labelPlacement","stacked","fill","outline","formControlName","inicio"],["type","date","label","Fin","labelPlacement","stacked","fill","outline","formControlName","fin"],["expand","block",3,"click","disabled"],["type","time","label","Hora","labelPlacement","stacked","fill","outline","formControlName","hora"],["type","file","accept","image/*",3,"change"],[1,"totales"],[4,"ngIf"],["color","medium","fill","outline",3,"click","disabled"],["color","medium","fill","outline",2,"margin-left","8px",3,"click","disabled"],[3,"value"]],template:function(a,e){a&1&&(t(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"h2",3),o(4,"Registrar Evento"),n(),t(5,"form",4),_(6,"ion-input",5)(7,"ion-input",6),t(8,"ion-select",7),b(9,X,2,2,"ion-select-option",8),n(),_(10,"br"),t(11,"ion-select",9),f("ionChange",function(p){return e.onLugaresChange(p.detail.value)}),b(12,Y,2,2,"ion-select-option",8),n(),_(13,"br")(14,"ion-textarea",10),n(),t(15,"h2",3),o(16,"Agregar fechas:"),n(),t(17,"form",11),_(18,"ion-input",12)(19,"ion-input",13),t(20,"ion-button",14),f("click",function(){return e.agregarFechasDeRango()}),o(21," Agregar fechas del rango "),n()(),t(22,"h2",3),o(23,"Agregar horas:"),n(),t(24,"form",11),_(25,"ion-input",15),t(26,"ion-button",14),f("click",function(){return e.agregarHora()}),o(27," Agregar hora "),n()(),t(28,"h2",3),o(29,"Imagen del evento"),n(),t(30,"input",16),f("change",function(p){return e.onFileChange(p)}),n(),t(31,"ion-card")(32,"ion-card-header")(33,"ion-card-title"),o(34,"Resumen"),n()(),t(35,"ion-card-content")(36,"div",17)(37,"div"),o(38,"Fechas: "),t(39,"strong"),o(40),n()(),t(41,"div"),o(42,"Horas: "),t(43,"strong"),o(44),n()(),t(45,"div"),o(46,"Lugares: "),t(47,"strong"),o(48),n()()(),b(49,Z,3,0,"div",18)(50,ee,3,1,"div",18),t(51,"ion-button",19),f("click",function(){return e.limpiarFechas()}),o(52," Limpiar fechas "),n(),t(53,"ion-button",20),f("click",function(){return e.limpiarHoras()}),o(54," Limpiar horas "),n()()(),t(55,"ion-button",14),f("click",function(){return e.guardarEvento()}),o(56," GUARDAR "),n()()()()),a&2&&(r(5),l("formGroup",e.eventoForm),r(4),l("ngForOf",e.artistasDisponibles),r(2),l("multiple",!0),r(),l("ngForOf",e.lugaresDisponibles),r(5),l("formGroup",e.fechaForm),r(3),l("disabled",e.fechaForm.invalid),r(4),l("formGroup",e.horaForm),r(2),l("disabled",e.horaForm.invalid),r(14),F(e.totalFechas),r(4),F(e.totalHoras),r(4),F(e.totalLugares),r(),l("ngIf",!e.imagenFile),r(),l("ngIf",e.imagenFile),r(),l("disabled",!e.json_fechas.length),r(2),l("disabled",!e.json_horas.length),r(2),l("disabled",e.saving||e.eventoForm.invalid||!e.json_fechas.length||!e.json_horas.length||!e.json_lugar.length||!e.imagenFile))},dependencies:[I,j,y,T,w,x,k,Q,H,R,q,V,z,J,B,U,$,K,L,G,A,M,D],styles:[".fondo-gradiente[_ngcontent-%COMP%]{--background: #0f0f0f;background:linear-gradient(to bottom,#0f0f0f,#111127);height:100%}.formulario-centro[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%;padding:1rem}.form-card[_ngcontent-%COMP%]{background:#0f0f0f;padding:2rem;border-radius:1.5rem;box-shadow:0 0 30px #7c3aed4d;width:100%;max-width:400px}.titulo[_ngcontent-%COMP%]{text-align:center;font-size:1.5rem;color:#fff;margin-bottom:1.5rem;font-weight:700}ion-input[_ngcontent-%COMP%], ion-textarea[_ngcontent-%COMP%]{--background: #1a1a2e;--color: white;--border-radius: .5rem;margin-bottom:1rem}ion-button[_ngcontent-%COMP%]{--background: #7c3aed;--border-radius: .5rem;--color: white;font-weight:700}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{padding:1.5rem;width:100%;max-width:90%}}@media (max-width: 480px){.titulo[_ngcontent-%COMP%]{font-size:1.3rem}ion-button[_ngcontent-%COMP%]{font-size:.9rem}}[_nghost-%COMP%], ion-app[_ngcontent-%COMP%], ion-router-outlet[_ngcontent-%COMP%], ion-page[_ngcontent-%COMP%]{display:block;height:100%}ion-content[_ngcontent-%COMP%]::part(scroll){overflow-y:auto!important;overscroll-behavior:contain;min-height:100%}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{overflow-y:auto!important}.formulario-centro[_ngcontent-%COMP%], .form-card[_ngcontent-%COMP%]{max-height:none!important;height:auto!important}"]});let s=d;return s})();export{ce as EventoPage};
