import{a as ae}from"./chunk-5ELSBVWL.js";import{C as re,a as z,c as $,d as H,e as J,f as K,g as Q,h as X,i as Y,j as Z,n as ee,o as te,p as ie,q as ne,r as oe}from"./chunk-LC3UPVSU.js";import"./chunk-ELOAIK2V.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VR5KVVOC.js";import"./chunk-3Q5GMNK6.js";import"./chunk-RS5YQJWL.js";import"./chunk-JROSCJGS.js";import"./chunk-OK2I7K27.js";import"./chunk-4CFH7RX6.js";import"./chunk-7FY2OE2O.js";import"./chunk-2QSXEBB7.js";import"./chunk-TTVFM5DY.js";import"./chunk-EZWARTTP.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-HLX4SABQ.js";import"./chunk-CKP3SGE2.js";import"./chunk-OVQHLAQL.js";import{$ as f,B as j,Da as T,F as P,I as u,J as n,K as a,L as _,R as k,S as v,T as F,_ as r,aa as I,ca as A,gb as o,hb as D,ia as x,ib as V,ka as C,kb as G,lb as q,mb as B,o as N,oa as O,p as M,pa as w,qb as U,rb as R,sb as W,ta as E,ua as L,x as s,z as b}from"./chunk-WQ2GXVAN.js";import"./chunk-IGVXFY24.js";import"./chunk-5TIAO6TV.js";import"./chunk-BANGDX2W.js";import"./chunk-FZQDFHAZ.js";import"./chunk-CLDSZD2A.js";import"./chunk-M2X7KQLB.js";import"./chunk-XTVTS2NW.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{a as S,b as y}from"./chunk-JHI3MBHO.js";function se(m,c){if(m&1&&(n(0,"ion-item")(1,"ion-label")(2,"div")(3,"strong"),r(4),a()(),n(5,"small"),r(6),x(7,"currency"),a()(),n(8,"div",21)(9,"div")(10,"strong"),r(11),x(12,"currency"),a()(),n(13,"small"),r(14,"Subtotal"),a()()()),m&2){let l=c.$implicit;s(4),f(l.descripcion),s(2),A(" N\xFAmeros: #",l.desde," \u2013 #",l.hasta," \xB7 Cant: ",l.cantidad," \xB7 Precio: ",C(7,6,l.precio,"USD","symbol","1.2-2")," "),s(5),f(C(12,11,l.subtotal,"USD","symbol","1.2-2"))}}function de(m,c){if(m&1){let l=k();n(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),r(3),a(),n(4,"ion-card-subtitle"),r(5),a()(),n(6,"ion-card-content")(7,"ion-list",17),P(8,se,15,16,"ion-item",18),a(),n(9,"div",19)(10,"div"),r(11,"Total asientos: "),n(12,"strong"),r(13),a()(),n(14,"div"),r(15,"Total estimado: "),n(16,"strong"),r(17),x(18,"currency"),a()()(),n(19,"ion-button",20),v("click",function(){N(l);let t=F();return M(t.limpiarAsientos())}),r(20," Limpiar lista "),a()()()}if(m&2){let l=F();s(3),I("Resumen de asientos (",l.json_asientos.length,")"),s(2),I("Pr\xF3ximo n\xFAmero: ",l.siguienteNumeroPreview),s(3),u("ngForOf",l.resumenAsientos),s(5),f(l.json_asientos.length),s(4),f(C(18,5,l.totalEstimado,"USD","symbol","1.2-2"))}}var ve=(()=>{let c=class c{constructor(i,t,e){this.fb=i,this.adminService=t,this.router=e,this.json_asientos=[],this.redirectAfterSave="/tabs-admin/evento",this.saving=!1,this.lugarForm=this.fb.group({nombre_lugar:["",[o.required,o.minLength(3),o.maxLength(120)]],capacidad:[0,[o.required,o.min(0)]],nombre_pais:["",[o.required,o.minLength(3),o.maxLength(80)]],nombre_ciudad:["",[o.required,o.minLength(2),o.maxLength(80)]]}),this.localidadForm=this.fb.group({descripcion:["",[o.required,o.maxLength(120)]],cantidad:[null,[o.required,o.min(1),o.max(5e3)]],precio:[null,[o.required,o.min(0)]]})}agregarLocalidad(){if(this.localidadForm.invalid)return;let{descripcion:i,cantidad:t,precio:e}=this.localidadForm.value,d=this.siguienteNumero(),g=this.padWidth;for(let h=0;h<Number(t);h++){let le=this.pad(d+h,g);this.json_asientos.push({numero:le,descripcion:i,precio:Number(e)})}let p=Number(this.lugarForm.get("capacidad")?.value||0);this.lugarForm.get("capacidad")?.setValue(p+Number(t)),this.localidadForm.reset(),this.localidadForm.markAsPristine(),this.localidadForm.markAsUntouched()}eliminarAsiento(i){this.json_asientos.splice(i,1)}limpiarAsientos(){this.json_asientos=[]}guardarlugar(){if(this.lugarForm.invalid||!this.json_asientos.length||this.saving){this.json_asientos.length||alert("Genera al menos un asiento.");return}this.saving=!0;let i=y(S({},this.lugarForm.value),{json_asientos:this.json_asientos});this.adminService.agregar_lugar(i).subscribe({next:t=>{t.status?(this.resetFormularioCompleto(),alert("Lugar registrado"),this.router.navigate(["/tabs-admin/calendario"])):alert(t.message||"Error al agregar lugar")},error:t=>{console.error("Error al registrar lugar:",t),alert("Hubo un problema. Int\xE9ntalo nuevamente.")},complete:()=>this.saving=!1})}get resumenAsientos(){let i=new Map;for(let e of this.json_asientos){let d=`${e.descripcion}__${e.precio}`,g=parseInt(e.numero,10)||0;i.has(d)||i.set(d,{descripcion:e.descripcion,precio:e.precio,cantidad:0,nums:[]});let p=i.get(d);p.cantidad+=1,p.nums.push(g)}let t=[];return i.forEach(e=>{e.nums.sort((p,h)=>p-h);let d=e.nums[0]??0,g=e.nums[e.nums.length-1]??0;t.push({descripcion:e.descripcion,precio:e.precio,cantidad:e.cantidad,subtotal:e.cantidad*Number(e.precio),desde:this.pad(d,this.padWidth),hasta:this.pad(g,this.padWidth)})}),t.sort((e,d)=>e.descripcion.localeCompare(d.descripcion)),t}resetFormularioCompleto(){this.lugarForm.reset({nombre_lugar:"",capacidad:0,nombre_pais:"",nombre_ciudad:""}),this.lugarForm.markAsPristine(),this.lugarForm.markAsUntouched(),this.localidadForm.reset(),this.localidadForm.markAsPristine(),this.localidadForm.markAsUntouched(),this.json_asientos=[];try{window?.scrollTo?.({top:0,behavior:"smooth"})}catch{}}siguienteNumero(){return this.json_asientos.length?Math.max(...this.json_asientos.map(t=>parseInt(t.numero,10)||0))+1:1}get padWidth(){return Math.max(this.json_asientos.length+1,99)>=100?3:2}pad(i,t=2){let e=String(i);return e.length>=t?e:"0".repeat(t-e.length)+e}get siguienteNumeroPreview(){return this.pad(this.siguienteNumero(),this.padWidth)}get totalEstimado(){return this.json_asientos.reduce((i,t)=>i+(Number(t.precio)||0),0)}};c.\u0275fac=function(t){return new(t||c)(b(U),b(ae),b(T))},c.\u0275cmp=j({type:c,selectors:[["app-lugar"]],decls:22,vars:6,consts:[["scroll-y","true",1,"fondo-gradiente",3,"fullscreen"],[1,"formulario-centro"],[1,"form-card"],[1,"titulo"],["name","location-outline",2,"vertical-align","middle","margin-right","8px"],[3,"ngSubmit","formGroup"],["label","Nombre del lugar","labelPlacement","floating","fill","outline","formControlName","nombre_lugar"],["label","Capacidad total","labelPlacement","floating","fill","outline","type","number","formControlName","capacidad"],["label","Nombre del pa\xEDs","labelPlacement","floating","fill","outline","formControlName","nombre_pais"],["label","Nombre de la ciudad","labelPlacement","floating","fill","outline","formControlName","nombre_ciudad"],[1,"grid-localidad",3,"formGroup"],["label","Descripci\xF3n (ej. Localidad VIP)","labelPlacement","floating","fill","outline","formControlName","descripcion"],["label","Cantidad","labelPlacement","floating","fill","outline","type","number","formControlName","cantidad"],["label","Precio","labelPlacement","floating","fill","outline","type","number","formControlName","precio"],["expand","block",3,"click","disabled"],[4,"ngIf"],["expand","block","type","submit",3,"disabled"],["lines","full"],[4,"ngFor","ngForOf"],[1,"totales"],["color","medium","fill","outline","expand","block",3,"click"],["slot","end",2,"text-align","right"]],template:function(t,e){t&1&&(n(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"h2",3),_(4,"ion-icon",4),r(5," Registrar lugar "),a(),n(6,"form",5),v("ngSubmit",function(){return e.guardarlugar()}),_(7,"ion-input",6)(8,"ion-input",7)(9,"ion-input",8)(10,"ion-input",9),n(11,"h2",3),r(12," Agregar asientos "),a(),n(13,"div",10),_(14,"ion-input",11)(15,"ion-input",12)(16,"ion-input",13),n(17,"ion-button",14),v("click",function(){return e.agregarLocalidad()}),r(18," Agregar asientos "),a()(),P(19,de,21,10,"ion-card",15),n(20,"ion-button",16),r(21," GUARDAR "),a()()()()()),t&2&&(u("fullscreen",!0),s(6),u("formGroup",e.lugarForm),s(7),u("formGroup",e.localidadForm),s(4),u("disabled",e.localidadForm.invalid),s(2),u("ngIf",e.json_asientos.length),s(),u("disabled",e.lugarForm.invalid||!e.json_asientos.length))},dependencies:[L,O,w,R,G,D,V,re,H,J,K,Q,X,Y,Z,ee,te,ie,ne,oe,z,$,W,q,B,E],styles:[".fondo-gradiente[_ngcontent-%COMP%]{--background: #0f0f0f;background:linear-gradient(to bottom,#0f0f0f,#111127);height:100%}.formulario-centro[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%;padding:1rem}.form-card[_ngcontent-%COMP%]{background:#0f0f0f;padding:2rem;border-radius:1.5rem;box-shadow:0 0 30px #7c3aed4d;width:100%;max-width:400px}.titulo[_ngcontent-%COMP%]{text-align:center;font-size:1.5rem;color:#fff;margin-bottom:1.5rem;font-weight:700}ion-input[_ngcontent-%COMP%], ion-textarea[_ngcontent-%COMP%]{--background: #1a1a2e;--color: white;--border-radius: .5rem;margin-bottom:1rem}ion-button[_ngcontent-%COMP%]{--background: #7c3aed;--border-radius: .5rem;--color: white;font-weight:700}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{padding:1.5rem;width:100%;max-width:90%}}@media (max-width: 480px){.titulo[_ngcontent-%COMP%]{font-size:1.3rem}ion-button[_ngcontent-%COMP%]{font-size:.9rem}}[_nghost-%COMP%], ion-app[_ngcontent-%COMP%], ion-router-outlet[_ngcontent-%COMP%], ion-page[_ngcontent-%COMP%]{display:block;height:100%}ion-content[_ngcontent-%COMP%]::part(scroll){overflow-y:auto!important;overscroll-behavior:contain;min-height:100%}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{overflow-y:auto!important}.formulario-centro[_ngcontent-%COMP%], .form-card[_ngcontent-%COMP%]{max-height:none!important;height:auto!important}"]});let m=c;return m})();export{ve as LugarPage};
