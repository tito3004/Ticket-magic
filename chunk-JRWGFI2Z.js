import{a as G}from"./chunk-6BXH6IQQ.js";import{a as B}from"./chunk-XISFFDA5.js";import{B as $,C as q,a as D,b as z,d as A,j as V,n as H,o as L,s as j,t as T}from"./chunk-LC3UPVSU.js";import"./chunk-ELOAIK2V.js";import"./chunk-QUJFQN2Y.js";import"./chunk-VR5KVVOC.js";import"./chunk-3Q5GMNK6.js";import"./chunk-RS5YQJWL.js";import"./chunk-JROSCJGS.js";import"./chunk-OK2I7K27.js";import"./chunk-4CFH7RX6.js";import"./chunk-7FY2OE2O.js";import"./chunk-2QSXEBB7.js";import"./chunk-TTVFM5DY.js";import"./chunk-EZWARTTP.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-HLX4SABQ.js";import"./chunk-CKP3SGE2.js";import"./chunk-OVQHLAQL.js";import{B as v,Da as O,F as h,I as d,J as a,K as r,L as b,S as C,_ as p,aa as _,ba as P,gb as u,hb as F,ib as S,kb as y,lb as w,mb as N,oa as x,qb as E,rb as I,sb as k,ua as M,x as s,z as f}from"./chunk-WQ2GXVAN.js";import"./chunk-IGVXFY24.js";import"./chunk-5TIAO6TV.js";import"./chunk-BANGDX2W.js";import"./chunk-FZQDFHAZ.js";import"./chunk-CLDSZD2A.js";import"./chunk-M2X7KQLB.js";import"./chunk-XTVTS2NW.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-JHI3MBHO.js";function R(c,l){if(c&1&&(a(0,"ion-select-option",11),p(1),r()),c&2){let m=l.$implicit;d("value",m.id),s(),_(" ",m.nombre," ")}}function U(c,l){if(c&1&&(a(0,"ion-select-option",11),p(1),r()),c&2){let m=l.$implicit;d("value",m.localidad),s(),P(" ",m.localidad," - ",m.lugar," ")}}function J(c,l){if(c&1&&(a(0,"ion-select-option",11),p(1),r()),c&2){let m=l.$implicit;d("value",m.id_fecha),s(),_(" ",m.fecha," ")}}function K(c,l){if(c&1&&(a(0,"ion-select-option",11),p(1),r()),c&2){let m=l.$implicit;d("value",m.id_hora),s(),_(" ",m.hora," ")}}var ae=(()=>{let l=class l{constructor(i,o,t,e){this.router=i,this.fb=o,this.usersService=t,this.publicService=e,this.rows=[],this.eventos=[],this.opcionesLocalidades=[],this.opcionesFechas=[],this.opcionesHoras=[],this.compraForm=this.fb.group({id_evento:[null,[u.required]],localidad:[null,[u.required]],id_fecha:[null,[u.required]],id_hora:[null,[u.required]],cantidad:[1,[u.required,u.min(1)]]})}ngOnInit(){this.publicService.consulta_eventos().subscribe(i=>{let o=(i?.value??[]).map(e=>({id_evento:Number(e.id_evento),nombre_evento:e.nombre_evento,localidad:e.descripcion||void 0,id_lugar:e.id_lugar!=null?Number(e.id_lugar):void 0,nombre_lugar:e.nombre_lugar,id_fecha:e.id_fecha!=null?Number(e.id_fecha):void 0,fecha:e.fecha,id_hora:e.id_hora!=null?Number(e.id_hora):void 0,hora:(e.hora||"").slice(0,5)||void 0,precio:e.precio}));this.rows=o;let t=new Set;this.eventos=o.filter(e=>{let n=Number(e.id_evento);return t.has(n)?!1:(t.add(n),!0)}).map(e=>({id:Number(e.id_evento),nombre:e.nombre_evento})),this.wireCascades()})}wireCascades(){this.compraForm.get("id_evento").valueChanges.subscribe(i=>{let o=Number(i||0);this.opcionesLocalidades=o?this.getLocalidadesVistaPorEvento(o):[],this.opcionesFechas=[],this.opcionesHoras=[],this.compraForm.patchValue({localidad:null,id_fecha:null,id_hora:null},{emitEvent:!1})}),this.compraForm.get("localidad").valueChanges.subscribe(i=>{let o=Number(this.compraForm.get("id_evento").value||0),t=(i||"").trim();this.opcionesFechas=o&&t?this.getFechasPorLocalidad(o,t):[],this.opcionesHoras=[],this.compraForm.patchValue({id_fecha:null,id_hora:null},{emitEvent:!1})}),this.compraForm.get("id_fecha").valueChanges.subscribe(i=>{let o=Number(this.compraForm.get("id_evento").value||0),t=(this.compraForm.get("localidad").value||"").trim(),e=Number(i||0);this.opcionesHoras=o&&t&&e?this.getHoras(o,t,e):[],this.compraForm.patchValue({id_hora:null},{emitEvent:!1})})}getLocalidadesVistaPorEvento(i){let o=new Map;for(let e of this.rows){if(Number(e.id_evento)!==i||!e.localidad||!e.nombre_lugar)continue;let n=`${e.localidad}__${e.nombre_lugar}`;o.has(n)||o.set(n,{localidad:e.localidad,lugar:e.nombre_lugar})}let t=Array.from(o.values());return t.sort((e,n)=>(e.localidad+e.lugar).localeCompare(n.localidad+n.lugar)),t}getFechasPorLocalidad(i,o){let t=new Map;for(let e of this.rows){if(Number(e.id_evento)!==i||(e.localidad||"").trim()!==o||e.id_fecha==null||!e.fecha)continue;let n=Number(e.id_fecha);t.has(n)||t.set(n,{id_fecha:n,fecha:e.fecha})}return Array.from(t.values()).sort((e,n)=>e.fecha.localeCompare(n.fecha))}getHoras(i,o,t){let e=new Map;for(let n of this.rows){if(Number(n.id_evento)!==i||(n.localidad||"").trim()!==o||Number(n.id_fecha)!==t||n.id_hora==null||!n.hora)continue;let g=Number(n.id_hora);e.has(g)||e.set(g,{id_hora:g,hora:n.hora})}return Array.from(e.values()).sort((n,g)=>n.hora.localeCompare(g.hora))}Compra(){if(this.compraForm.invalid){alert("Por favor, completa todos los campos correctamente.");return}let i=this.compraForm.value;this.usersService.comprarBoletos(i).subscribe({next:o=>{o.status?(this.compraForm.reset(),console.log(o.link),window.location.href=o.link):alert(o.message||"No se pudo completar la compra.")},error:o=>{console.error("Error al comprar:",o),alert("Hubo un problema al procesar la compra.")}})}};l.\u0275fac=function(o){return new(o||l)(f(O),f(E),f(B),f(G))},l.\u0275cmp=v({type:l,selectors:[["app-compra"]],decls:27,vars:8,consts:[[1,"compra-container"],[1,"compra-card"],[3,"ngSubmit","formGroup"],["formControlName","id_evento","placeholder","Selecciona evento","interface","popover"],[3,"value",4,"ngFor","ngForOf"],["formControlName","localidad","placeholder","Selecciona localidad - lugar","interface","popover",3,"disabled"],["formControlName","id_fecha",3,"disabled"],["formControlName","id_hora",3,"disabled"],["type","number","min","1","formControlName","cantidad"],["expand","block","type","submit",1,"boton-finalizar"],["name","paypal-outline"],[3,"value"]],template:function(o,t){o&1&&(a(0,"ion-content",0)(1,"div",1)(2,"h2"),p(3,"Finaliza tu compra"),r(),a(4,"form",2),C("ngSubmit",function(){return t.Compra()}),a(5,"label"),p(6,"Selecciona un evento"),r(),a(7,"ion-select",3),h(8,R,2,2,"ion-select-option",4),r(),a(9,"label"),p(10,"Localidades disponibles"),r(),a(11,"ion-select",5),h(12,U,2,3,"ion-select-option",4),r(),a(13,"label"),p(14,"Fechas disponibles"),r(),a(15,"ion-select",6),h(16,J,2,2,"ion-select-option",4),r(),a(17,"label"),p(18,"Horas disponibles"),r(),a(19,"ion-select",7),h(20,K,2,2,"ion-select-option",4),r(),a(21,"label"),p(22,"Cantidad de entradas"),r(),b(23,"ion-input",8),a(24,"ion-button",9),p(25," Finalizar compra - Via PayPal "),b(26,"ion-icon",10),r()()()()),o&2&&(s(4),d("formGroup",t.compraForm),s(4),d("ngForOf",t.eventos),s(3),d("disabled",!t.opcionesLocalidades.length),s(),d("ngForOf",t.opcionesLocalidades),s(3),d("disabled",!t.opcionesFechas.length),s(),d("ngForOf",t.opcionesFechas),s(3),d("disabled",!t.opcionesHoras.length),s(),d("ngForOf",t.opcionesHoras))},dependencies:[M,x,I,y,F,S,q,A,V,H,L,j,T,D,z,$,k,w,N],styles:[".compra-container[_ngcontent-%COMP%]{--background: #0f0f17;color:#fff;display:flex;justify-content:center;align-items:center}.compra-card[_ngcontent-%COMP%]{background-color:#1b1c25;padding:2rem;border-radius:20px;max-width:500px;width:90%;margin:2rem auto;box-shadow:0 0 20px #00000080}h2[_ngcontent-%COMP%]{font-size:1.8rem;margin-bottom:1.5rem;text-align:center}label[_ngcontent-%COMP%]{font-weight:700;margin-top:1rem;display:block}ion-select[_ngcontent-%COMP%], ion-input[_ngcontent-%COMP%]{margin-top:.5rem;margin-bottom:1rem;background-color:#2c2e3a;--color: white;--placeholder-color: #aaa;border-radius:10px}.fechas[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin:1rem 0}.fecha-btn[_ngcontent-%COMP%]{background-color:#2c2e3a;color:#fff;border:none;border-radius:15px;padding:8px 12px;cursor:pointer;transition:background-color .3s}.fecha-btn.activa[_ngcontent-%COMP%]{background-color:#7c3aed}.fecha-btn[_ngcontent-%COMP%]:hover{background-color:#5b2cba}.metodos-pago[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center;margin:1.5rem 0}.metodos-pago[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:50px;object-fit:contain;cursor:pointer;transition:transform .3s ease,box-shadow .3s ease;border-radius:8px;padding:5px}.metodos-pago[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{transform:scale(1.1);box-shadow:0 0 10px #7c3aed}.metodos-pago[_ngcontent-%COMP%]   img.seleccionado[_ngcontent-%COMP%]{border:2px solid #7C3AED}.boton-finalizar[_ngcontent-%COMP%]{--background: linear-gradient(90deg, #7C3AED 0%, #9333EA 100%);--background-activated: linear-gradient(90deg, #6D28D9 0%, #7C3AED 100%);--background-focused: linear-gradient(90deg, #6D28D9 0%, #7C3AED 100%);--background-hover: linear-gradient(90deg, #6D28D9 0%, #7C3AED 100%);--color: white;--border-radius: 12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;height:48px;box-shadow:0 4px 12px #7c3aed99;transition:transform .2s ease-in-out}.boton-finalizar[_ngcontent-%COMP%]:active{transform:scale(.97)}ion-button.boton-finalizar[disabled][_ngcontent-%COMP%]{opacity:.6;background:linear-gradient(90deg,#7c3aed,#9333ea)!important}@media (max-width: 768px){.compra-card[_ngcontent-%COMP%], .register-box[_ngcontent-%COMP%], .login-box[_ngcontent-%COMP%], .start-container[_ngcontent-%COMP%], .eventos-section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{width:95%!important;margin:auto;font-size:14px}.eventos-section[_ngcontent-%COMP%]   .fila-eventos[_ngcontent-%COMP%]{flex-direction:column;align-items:center}.eventos-section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%!important;height:auto}ion-input[_ngcontent-%COMP%], ion-button[_ngcontent-%COMP%], .fecha-btn[_ngcontent-%COMP%], .boton-finalizar[_ngcontent-%COMP%]{font-size:14px}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%]{font-size:18px!important}.btn-ticket[_ngcontent-%COMP%]{width:90%;margin:8px auto;padding:10px;font-size:14px}}"]});let c=l;return c})();export{ae as CompraPage};
