{
  "version": 3,
  "sources": ["src/app/services/users.service.ts"],
  "sourcesContent": ["// Servicio de usuarios: registro, recuperación, compra de boletos y consultas al backend\r\nimport { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Observable, of } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\n\r\nexport interface ApiResponse<T = any> {\r\n  status: boolean;\r\n  message: string;\r\n  value?: any;\r\n  link?: any;\r\n  data?: any;\r\n}\r\n\r\nexport interface CompraResumen {\r\n  cod_unico_boleto: string;\r\n  nombre_evento: string;\r\n  fecha: string;   // 'YYYY-MM-DD'\r\n  hora: string;    // 'HH:mm' o 'HH:mm:ss'\r\n  correo: string;\r\n  cantidad: number;\r\n}\r\n\r\n@Injectable({ providedIn: 'any' })\r\nexport class UsersService {\r\n  // Base URL del backend (módulo usuario)\r\n  private url = 'http://localhost:3000/sistema_reserva/usuario';\r\n\r\n  // Headers para peticiones JSON (no usar con FormData)\r\n  private jsonHeaders = new HttpHeaders({ 'Content-Type': 'application/json; charset=utf-8' });\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  // Llamada HTTP: registrar usuario\r\n  register(datos: any): Observable<ApiResponse> {\r\n    return this.http.post<ApiResponse>(`${this.url}/registro`, datos, { headers: this.jsonHeaders })\r\n      .pipe(\r\n        catchError(error => {\r\n          console.error('Error al registrar usuario:', error);\r\n          const backendMessage = error?.error?.message || 'Error desconocido';\r\n          return of({ status: false, message: backendMessage });\r\n        })\r\n      );\r\n  }\r\n\r\n  // Llamada HTTP: solicitar restauración de cuenta (envío de mail con link)\r\n  recuperar(datos: any): Observable<ApiResponse> {\r\n    return this.http.post<ApiResponse>(`${this.url}/restaurar_cuenta`, datos, { headers: this.jsonHeaders })\r\n      .pipe(\r\n        catchError(error => {\r\n          console.error('Error al restaurar cuenta:', error);\r\n          const backendMessage = error?.error?.message || 'Error desconocido';\r\n          return of({ status: false, message: backendMessage });\r\n        })\r\n      );\r\n  }\r\n\r\n  // Llamada HTTP: confirmar pago exitoso (PayPal) y registrar compra\r\n  pagorealizado(cod_unico_boleto: any, payerid: any, token: any): Observable<ApiResponse> {\r\n    return this.http\r\n      .get<ApiResponse>(`${this.url}/consulta_boleto/?cod_unico_boleto=${cod_unico_boleto}&token=${token}&PayerID=${payerid}`, { headers: this.jsonHeaders })\r\n      .pipe(\r\n        catchError(error => {\r\n          console.error('Error al verificar el token:', error);\r\n          const backendMessage = error?.error?.message || 'Error desconocido';\r\n          return of({ status: false, message: backendMessage } as ApiResponse);\r\n        })\r\n      );\r\n  }\r\n\r\n  // Llamada HTTP: cancelar compra tras pago cancelado (eliminar boletos)\r\n  pagocancelado(cod_unico_boleto: any): Observable<ApiResponse> {\r\n    return this.http\r\n      .get<ApiResponse>(`${this.url}/eliminar_boletos/?cod_unico_boleto=${cod_unico_boleto}`, { headers: this.jsonHeaders })\r\n      .pipe(\r\n        catchError(error => {\r\n          console.error('Error al verificar el token:', error);\r\n          const backendMessage = error?.error?.message || 'Error desconocido';\r\n          return of({ status: false, message: backendMessage } as ApiResponse);\r\n        })\r\n      );\r\n  }\r\n\r\n  // Llamada HTTP: enviar formulario de inconvenientes\r\n  formularioInconvenientes(datos: any): Observable<ApiResponse> {\r\n    return this.http.post<ApiResponse>(`${this.url}/formulario_incovenientes`, datos, { headers: this.jsonHeaders })\r\n      .pipe(\r\n        catchError(error => {\r\n          console.error('Error al enviar formulario:', error);\r\n          const backendMessage = error?.error?.message || 'Hubo un problema al procesar la solicitud.';\r\n          return of({ status: false, message: backendMessage });\r\n        })\r\n      );\r\n  }\r\n\r\n  // Llamada HTTP: iniciar proceso de compra (devuelve link de pago y código)\r\n  comprarBoletos(datos: any): Observable<ApiResponse> {\r\n    return this.http.post<ApiResponse>(`${this.url}/compra_boletos`, datos, { headers: this.jsonHeaders })\r\n      .pipe(\r\n        catchError(error => {\r\n          console.error('Error al comprar boletos:', error);\r\n          const backendMessage = error?.error?.message || 'Hubo un problema al procesar la solicitud.';\r\n          return of({ status: false, message: backendMessage });\r\n        })\r\n      );\r\n  }\r\n\r\n  // Llamada HTTP: resumen por código único (para QR / admin comprobar)\r\n  getResumenPorCodigo(codUnicoBoleto: any): Observable<ApiResponse<CompraResumen[]>> {\r\n    return this.http.get<ApiResponse<CompraResumen[]>>(`${this.url}/consulta_boletos_qr/?cod_unico_boleto=${codUnicoBoleto}`)\r\n      .pipe(\r\n        catchError(err => {\r\n          const msg = err?.error?.message || 'No se pudo consultar el QR';\r\n          return of({ status: false, message: msg } as ApiResponse<CompraResumen[]>);\r\n        })\r\n      );\r\n  }\r\n\r\n  // Llamada HTTP: compras del usuario autenticado (agrupadas por código único)\r\n  getResumenPorUsuario(): Observable<ApiResponse<CompraResumen[]>> {\r\n    return this.http\r\n      .get<ApiResponse<CompraResumen[]>>(`${this.url}/consulta_boletos_por_usuario`, { headers: this.jsonHeaders })\r\n      .pipe(\r\n        catchError(err => {\r\n          const msg = err?.error?.message || 'No se pudo consultar las compras del usuario';\r\n          return of({ status: false, message: msg } as ApiResponse<CompraResumen[]>);\r\n        })\r\n      );\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
