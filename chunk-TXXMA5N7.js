import{a as l,c as s,f as n,g as a,i as c,k as h,wa as u,xa as m}from"./chunk-WQ2GXVAN.js";var k=(()=>{let o=class o{get token(){return localStorage.getItem(this.tokenKey)}set token(e){e?localStorage.setItem(this.tokenKey,e):localStorage.removeItem(this.tokenKey)}normalizeToken(e){if(!e)return null;if(typeof e=="string")return e;if(Array.isArray(e)&&e.every(t=>typeof t=="string"))return e.join(".");if(typeof e=="object")try{let t=JSON.parse(JSON.stringify(e));if(Array.isArray(t))return t.join(".");if(typeof t=="string")return t}catch{}return null}get isAdmin$(){return this.rol$.asObservable()}get isAdmin(){return this.rol$.value}seedRoleFromStorage(){let e=localStorage.getItem(this.roleKey);if(e===null)return null;let t=e.toLowerCase()==="true";return this.rol$.next(t),t}ensureRole$(){if(this.rol$.value!==null)return s(this.rol$.value);let e=this.seedRoleFromStorage();return s(e)}login(e){return this.http.post(`${this.url}/login`,e,{headers:this.headers}).pipe(a(t=>{let r=this.normalizeToken(t?.token);r&&(this.token=r),typeof t?.rol=="boolean"?(this.rol$.next(t.rol),localStorage.setItem(this.roleKey,String(t.rol))):(this.rol$.next(null),localStorage.removeItem(this.roleKey))}),n(t=>{console.error("Error al iniciar sesi\xF3n:",t);let r=t?.error?.message??"Error desconocido";return s({status:!1,message:r})}))}logout(){this.token=null,this.rol$.next(null),localStorage.removeItem(this.roleKey)}verificarToken(e){return this.http.get(`${this.url}/verificar?token=${e}`).pipe(n(t=>{console.error("Error al verificar el token:",t);let r=t?.error?.message||"Error desconocido";return s({status:!1,message:r})}))}recuperando(e,t){return this.http.post(`${this.url}/restaurar?token=${e}`,t,{headers:this.headers}).pipe(n(r=>{console.error("Error al restaurar:",r);let f=r?.error?.message||"Error desconocido";return s({status:!1,message:f})}))}constructor(e){this.http=e,this.url="http://localhost:3000/sistema_reserva/auth",this.headers=new u({"Content-Type":"application/json; charset=utf-8"}),this.rol$=new l(null),this.tokenKey="token",this.roleKey="is_admin"}};o.\u0275fac=function(t){return new(t||o)(h(m))},o.\u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();export{k as a};
